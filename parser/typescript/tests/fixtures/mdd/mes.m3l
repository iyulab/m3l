# Namespace: umes.ray.mes

> U-MES.Ray - Core MES Data Model
> 레이저 절단 MES 기본 구성 (설비 연동 독립적인 표준 MES 레이어)

## BaseEntity

- id: identifier @primary @generated
- created_at: timestamp = now()
- updated_at: timestamp = now() @on_update(now())
- is_deleted: boolean = false

## Auditable ::interface

- created_by: string(100)?
- updated_by: string(100)?

---

## WorkOrderStatus ::enum

- CREATED "생성"
- RELEASED "출고"
- IN_PROGRESS "진행중"
- PAUSED "일시정지"
- COMPLETED "완료"
- CLOSED "마감"
- CANCELLED "취소"

## ProductionType ::enum

- NORMAL "정상"
- REWORK "재작업"
- SAMPLE "샘플"
- TRIAL "시험"

## InspectionType ::enum

- INCOMING "수입검사"
- IN_PROCESS "공정검사"
- FINAL "최종검사"
- PATROL "순회검사"

## InspectionResultType ::enum

- PASS "합격"
- FAIL "불합격"
- CONDITIONAL "조건부합격"

## DefectSeverity ::enum

- CRITICAL "치명"
- MAJOR "중대"
- MINOR "경미"

## DefectDisposition ::enum

- SCRAP "폐기"
- REWORK "재작업"
- USE_AS_IS "특채"
- RETURN "반품"

## MaintenanceType ::enum

- PREVENTIVE "예방"
- CORRECTIVE "사후"
- PREDICTIVE "예지"
- BREAKDOWN "고장"

## DowntimeCategory ::enum

- PLANNED "계획"
- UNPLANNED "비계획"

## CAPAStatus ::enum

- OPEN "등록"
- IN_PROGRESS "진행"
- CLOSED "완료"
- VERIFIED "검증완료"

---

## Customer(거래처) : BaseEntity

- code: string(50) @unique "거래처 코드"
- name: string(200) @searchable "거래처명"
- contact_name: string(100)? "담당자"
- phone: phone? "연락처"
- email: email? "이메일"
- address: string(500)? "주소"
- is_active: boolean = true

## Material(소재) : BaseEntity

- code: string(50) @unique "소재 코드"
- name: string(200) @searchable "소재명 (냉연판, SUS304, AL5052, 동판 등)"
- category: string(100)? "분류 (철판, 스테인리스, 알루미늄, 동, 황동 등)"
- density: decimal(8, 4)? "밀도 (g/cm3)"
- is_active: boolean = true

## MaterialSpec(소재규격) : BaseEntity

- material_id: identifier @reference(Material) @index "소재"
- thickness: decimal(8, 2) "두께 (mm)"
- width: decimal(10, 1)? "폭 (mm)"
- length: decimal(10, 1)? "길이 (mm)"
- size_label: string(50)? "규격 라벨 (2000x3000 등)"
- unit_price: decimal(12, 2)? "단가 (원/장 또는 원/kg)"
- weight_per_unit: decimal(10, 3)? "단위 중량 (kg)"

### Lookup
- material_name: string @lookup(material_id.name) "소재명"

- @unique(material_id, thickness, width, length) "소재규격 복합 유니크"

---

## Part(부품) : BaseEntity, Auditable

- code: string(50) @unique @searchable "부품 코드"
- name: string(200) @searchable "부품명"
- customer_id: identifier? @reference(Customer) @index "거래처"
- material_id: identifier? @reference(Material) @index "기본 소재"
- thickness: decimal(8, 2)? "두께 (mm)"
- drawing_no: string(100)? "도면 번호"
- drawing_revision: string(20)? "도면 리비전"
- drawing_file: string(500)? "도면 파일 경로"
- unit: string(20) = "EA" "단위"
- standard_time_sec: integer? "표준 가공시간 (초)"
- unit_weight: decimal(10, 3)? "단중 (kg)"
- is_active: boolean = true

### Lookup
- customer_name: string? @lookup(customer_id.name) "거래처명"
- material_name: string? @lookup(material_id.name) "소재명"

---

## MachineGroup(설비그룹) : BaseEntity

- code: string(50) @unique "그룹 코드"
- name: string(200) "그룹명"
- description: string(500)?

## Machine(설비) : BaseEntity, Auditable

- code: string(50) @unique @searchable "설비 코드"
- name: string(200) @searchable "설비명"
- machine_group_id: identifier? @reference(MachineGroup) @index "설비 그룹"
- machine_type: string(100)? "설비 유형"
- manufacturer: string(200)? "제조사"
- model_no: string(100)? "모델번호"
- serial_no: string(100)? "시리얼번호"
- location: string(200)? "설치 위치"
- install_date: date? "설치일"
- is_active: boolean = true

### Lookup
- group_name: string? @lookup(machine_group_id.name) "설비그룹명"

---

## Worker(작업자) : BaseEntity

- employee_no: string(50) @unique "사번"
- name: string(100) @searchable "성명"
- department: string(100)? "부서"
- role: string(100)? "역할 (오퍼레이터, 검사원, 보전원 등)"
- phone: phone? "연락처"
- is_active: boolean = true

---

## DefectCode(불량코드) : BaseEntity

- code: string(50) @unique "불량 코드"
- name: string(200) "불량명"
- severity: DefectSeverity = "MINOR" "심각도"
- category: string(100)? "분류"
- is_active: boolean = true

## DowntimeCode(비가동코드) : BaseEntity

- code: string(50) @unique "비가동 코드"
- name: string(200) "비가동 사유"
- category: DowntimeCategory "계획/비계획"
- is_active: boolean = true

---

## WorkOrder(작업지시) : BaseEntity, Auditable

- order_no: string(50) @unique @searchable "작업지시 번호"
- customer_id: identifier? @reference(Customer) @index "거래처"
- customer_order_no: string(100)? "수주 번호"
- status: WorkOrderStatus = "CREATED" @index
- priority: integer = 5 "우선순위 (1=최고, 10=최저)"
- due_date: date? @index "납기일"
- planned_start: timestamp? "계획 시작"
- planned_end: timestamp? "계획 종료"
- actual_start: timestamp? "실제 시작"
- actual_end: timestamp? "실제 종료"
- remark: string(1000)?

### Lookup
- customer_name: string? @lookup(customer_id.name) "거래처명"

### Rollup
- item_count: integer @rollup(WorkOrderItem.work_order_id, count) "항목 수"
- total_order_qty: decimal(10, 2) @rollup(WorkOrderItem.work_order_id, sum(order_qty)) "총 지시수량"
- total_good_qty: decimal(10, 2) @rollup(WorkOrderItem.work_order_id, sum(good_qty)) "총 양품수량"
- total_defect_qty: decimal(10, 2) @rollup(WorkOrderItem.work_order_id, sum(defect_qty)) "총 불량수량"

## WorkOrderItem(작업지시항목) : BaseEntity

- work_order_id: identifier @reference(WorkOrder) @index "작업지시"
- seq: integer "순번"
- part_id: identifier @reference(Part) @index "부품"
- material_spec_id: identifier? @reference(MaterialSpec) "소재 규격"
- order_qty: decimal(10, 2) "지시 수량"
- good_qty: decimal(10, 2) = 0 "양품 수량"
- defect_qty: decimal(10, 2) = 0 "불량 수량"
- scrap_qty: decimal(10, 2) = 0 "스크랩 수량"
- production_type: ProductionType = "NORMAL"
- status: WorkOrderStatus = "CREATED"
- remark: string(500)?

### Lookup
- part_code: string @lookup(part_id.code) "부품코드"
- part_name: string @lookup(part_id.name) "부품명"

---

## ProductionResult(생산실적) : BaseEntity

- work_order_id: identifier? @reference(WorkOrder) @index "작업지시"
- work_order_item_id: identifier? @reference(WorkOrderItem) "작업지시항목"
- machine_id: identifier @reference(Machine) @index "설비"
- worker_id: identifier? @reference(Worker) "작업자"
- part_id: identifier? @reference(Part) "부품"
- shift: string(20)? "근무조"
- start_time: timestamp @index "시작"
- end_time: timestamp? "종료"
- good_qty: decimal(10, 2) = 0 "양품"
- defect_qty: decimal(10, 2) = 0 "불량"
- scrap_qty: decimal(10, 2) = 0 "스크랩"
- production_type: ProductionType = "NORMAL"
- remark: string(500)?

### Lookup
- machine_name: string @lookup(machine_id.name) "설비명"
- worker_name: string? @lookup(worker_id.name) "작업자명"
- order_no: string? @lookup(work_order_id.order_no) "작업지시번호"

---

## InspectionPlan(검사계획) : BaseEntity, Auditable

- part_id: identifier @reference(Part) @index "부품"
- inspection_type: InspectionType "검사 유형"
- version: string(20) = "1.0"
- sampling_rule: string(200)? "샘플링 (전수, AQL 등)"
- is_active: boolean = true

### Lookup
- part_name: string @lookup(part_id.name) "부품명"

## InspectionItem(검사항목) : BaseEntity

- inspection_plan_id: identifier @reference(InspectionPlan) @index "검사계획"
- seq: integer "순서"
- item_name: string(200) "항목명 (치수, 평탄도, 절단면 품질, 버, 직각도 등)"
- nominal_value: decimal(12, 4)? "기준값"
- upper_limit: decimal(12, 4)? "상한"
- lower_limit: decimal(12, 4)? "하한"
- unit: string(20)? "단위 (mm, deg 등)"
- measurement_tool: string(200)? "측정기구"
- is_critical: boolean = false "주요 치수 여부"

## InspectionRecord(검사기록) : BaseEntity

- inspection_plan_id: identifier? @reference(InspectionPlan)
- work_order_id: identifier? @reference(WorkOrder) @index "작업지시"
- part_id: identifier? @reference(Part) @index "부품"
- lot_no: string(100)? "LOT 번호"
- inspector_id: identifier? @reference(Worker) "검사원"
- inspection_type: InspectionType "검사 유형"
- inspected_at: timestamp = now() @index "검사일시"
- sample_qty: integer? "검사 수량"
- pass_qty: integer? "합격"
- fail_qty: integer? "불합격"
- result: InspectionResultType "판정"
- remark: string(500)?

### Lookup
- inspector_name: string? @lookup(inspector_id.name) "검사원명"
- part_name: string? @lookup(part_id.name) "부품명"

## InspectionMeasurement(검사측정값) : BaseEntity

- inspection_record_id: identifier @reference(InspectionRecord) @index "검사기록"
- inspection_item_id: identifier @reference(InspectionItem) "검사항목"
- sample_no: integer = 1 "시료번호"
- measured_value: decimal(12, 4)? "측정값"
- result: InspectionResultType "판정"
- remark: string(200)?

## DefectRecord(불량기록) : BaseEntity

- work_order_id: identifier? @reference(WorkOrder) @index
- production_result_id: identifier? @reference(ProductionResult)
- defect_code_id: identifier @reference(DefectCode) @index "불량코드"
- part_id: identifier? @reference(Part) "부품"
- quantity: decimal(10, 2) "불량 수량"
- disposition: DefectDisposition? "처분"
- detected_at: timestamp = now()
- detected_by: identifier? @reference(Worker) "발견자"
- remark: string(500)?

### Lookup
- defect_name: string @lookup(defect_code_id.name) "불량명"
- part_name: string? @lookup(part_id.name) "부품명"

## CAPA(시정예방조치) : BaseEntity, Auditable

- title: string(200) "제목"
- source_type: string(50)? "발생원 (검사불합격, 고객불만, 공정이상)"
- source_ref: string(100)? "참조 번호"
- description: text "문제 내용"
- root_cause: text? "근본 원인"
- corrective_action: text? "시정 조치"
- preventive_action: text? "예방 조치"
- responsible_id: identifier? @reference(Worker) "담당자"
- target_date: date? "목표 완료일"
- completed_at: timestamp? "완료일시"
- status: CAPAStatus = "OPEN" @index

### Lookup
- responsible_name: string? @lookup(responsible_id.name) "담당자명"

---

## MaintenancePlan(보전계획) : BaseEntity, Auditable

- machine_id: identifier @reference(Machine) @index "설비"
- maintenance_type: MaintenanceType "보전 유형"
- title: string(200) "보전 항목"
- description: text? "상세 내용"
- interval_days: integer? "주기 (일)"
- interval_hours: integer? "주기 (가동시간)"
- checklist: text? "점검 항목 (JSON)"
- last_performed_at: timestamp? "최근 수행일"
- next_due_at: timestamp? @index "다음 예정일"
- is_active: boolean = true

### Lookup
- machine_name: string @lookup(machine_id.name) "설비명"

## MaintenanceRecord(보전기록) : BaseEntity

- maintenance_plan_id: identifier? @reference(MaintenancePlan) @index "보전계획"
- machine_id: identifier @reference(Machine) @index "설비"
- maintenance_type: MaintenanceType "유형"
- title: string(200) "보전 내용"
- performed_by: identifier? @reference(Worker) "수행자"
- start_time: timestamp @index "시작"
- end_time: timestamp? "종료"
- duration_min: decimal(10, 2)? "소요시간 (분)"
- parts_replaced: string(1000)? "교체 부품"
- cost: decimal(12, 2)? "비용"
- result: string(500)? "결과"
- remark: string(1000)?

### Lookup
- machine_name: string @lookup(machine_id.name) "설비명"
- performed_by_name: string? @lookup(performed_by.name) "수행자명"

---

## DowntimeEvent(비가동이벤트) : BaseEntity

- machine_id: identifier @reference(Machine) @index "설비"
- downtime_code_id: identifier? @reference(DowntimeCode) @index "비가동코드"
- category: DowntimeCategory "계획/비계획"
- start_time: timestamp @index "시작"
- end_time: timestamp? "종료"
- duration_min: decimal(10, 2)? "소요시간 (분)"
- work_order_id: identifier? @reference(WorkOrder)
- reported_by: identifier? @reference(Worker) "보고자"
- remark: string(500)?

### Lookup
- machine_name: string @lookup(machine_id.name) "설비명"
- downtime_reason: string? @lookup(downtime_code_id.name) "비가동 사유"

---

## OEERecord(OEE기록) : BaseEntity

- machine_id: identifier @reference(Machine) @index "설비"
- record_date: date @index "기준일"
- shift: string(20)? "근무조"
- planned_time_min: decimal(10, 2) "계획 가동시간 (분)"
- operating_time_min: decimal(10, 2) "실 가동시간 (분)"
- downtime_min: decimal(10, 2) = 0 "비가동시간 (분)"
- total_count: integer = 0 "총 생산수"
- good_count: integer = 0 "양품수"
- defect_count: integer = 0 "불량수"
- availability: decimal(5, 4)? "가동률"
- performance: decimal(5, 4)? "성능"
- quality_rate: decimal(5, 4)? "품질률"

### Lookup
- machine_name: string @lookup(machine_id.name) "설비명"

### Computed
- oee: decimal(5, 4)? @computed("availability * performance * quality_rate") "OEE"

- @unique(machine_id, record_date, shift) "OEE 복합 유니크"
